<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prompt Framework Library</title>
<style>
  body { margin: 0; background-color: #0e0e0e; color: #f5f5f5; font-family: Arial, sans-serif; }
  .container { display: flex; height: 100vh; }
  .sidebar { width: 250px; background-color: #141414; padding: 20px; border-right: 1px solid #333; }
  .sidebar h2 { color: #e2b714; margin-top: 0; }
  .sidebar button {
    width: 100%; margin: 8px 0; padding: 10px; background-color: #1c1c1c;
    color: #f5f5f5; border: 1px solid #333; border-radius: 8px; cursor: pointer;
  }
  .sidebar button:hover { background-color: #222; }
  .main { flex-grow: 1; padding: 30px; overflow-y: auto; }
  h1 { color: #e2b714; margin-bottom: 10px; }
  textarea, input {
    width: 100%; background-color: #121212; border: 1px solid #333;
    color: #f5f5f5; border-radius: 8px; padding: 10px; margin-bottom: 15px;
  }
  button.action {
    background-color: #222; color: #f5f5f5; border: 1px solid #333;
    border-radius: 8px; padding: 10px 16px; cursor: pointer; margin-right: 8px;
  }
  pre {
    background-color: #121212; border: 1px solid #333; border-radius: 8px;
    padding: 14px; white-space: pre-wrap; line-height: 1.5;
  }
  a { color: #e2b714; text-decoration: none; }
</style>
</head>
<body>
<div class="container">
  <div class="sidebar">
    <h2>Categories</h2>
    <button onclick="loadCategory('strategy')">Strategy</button>
    <button onclick="loadCategory('marketing')">Marketing</button>
    <button onclick="loadCategory('ux')">UX Writing</button>
    <button onclick="loadCategory('analysis')">Analysis</button>
    <div style="margin-top:20px"><a href="../../">← Back to Portfolio</a></div>
  </div>

  <div class="main">
    <h1>Prompt Framework Library</h1>
    <p>Select a category and edit or run your own prompt framework below.</p>

    <input id="variables" placeholder="Variables (comma-separated): product, audience, budget, deadline" />
    <textarea id="template" rows="10" placeholder="Select a template to begin..."></textarea>

    <div>
      <button class="action" onclick="insertTemplate()">Insert Example Vars</button>
      <button class="action" onclick="runPrompt()">Generate Brief</button>
      <button class="action" onclick="copyOutput()">Copy Output</button>
    </div>

    <pre id="output">Output will appear here…</pre>
  </div>
</div>

<script>
const API_URL = "https://a8ad6bfd-0b9e-4c04-b86b-ee6f5673b396-00-3j9vlmht90fsh.picard.replit.dev/generate";

const templates = {
  strategy: `Role: Senior AI Product Strategist
Task: Convert a plain request into a structured brief.

Input:
- Product: {product}
- Audience: {audience}
- Budget: {budget}
- Deadline: {deadline}

Output JSON keys only:
prompt, brief.problem[], brief.users[], brief.solution[], brief.value[], brief.risks[], brief.next_actions[]`,

  marketing: `Role: Marketing Strategist
Task: Create a positioning brief for {product} targeting {audience}.
Return JSON with keys: brief.value[], brief.solution[], brief.next_actions[]`,

  ux: `Role: UX Writer
Task: Design a 3-step onboarding flow for {product}.
Return JSON with keys: brief.solution[], brief.risks[], brief.value[]`,

  analysis: `Role: AI Analyst
Task: Provide a churn analysis framework for {product} in {segment}.
Return JSON with keys: brief.problem[], brief.risks[], brief.next_actions[]`
};

// Load template and auto-detect placeholders → populate Variables box
function loadCategory(cat) {
  const tpl = templates[cat] || '';
  document.getElementById('template').value = tpl;

  const names = Array.from(new Set(
    (tpl.match(/\{([^}]+)\}/g) || [])
      .map(s => s.slice(1, -1).replace(/\W/g, ''))
      .filter(Boolean)
  ));
  if (names.length) {
    document.getElementById('variables').value = names.join(', ');
  }
}

// Replace placeholders with example values; tolerant of spaces inside { }
function insertTemplate() {
  const tplEl = document.getElementById('template');
  let text = tplEl.value;

  // names: from input or auto-detected from template
  const raw = document.getElementById('variables').value.trim();
  const names = raw
    ? raw.split(',').map(s => s.trim().replace(/\W/g, '')).filter(Boolean)
    : Array.from(new Set(
        (text.match(/\{([^}]+)\}/g) || [])
          .map(s => s.slice(1, -1).replace(/\W/g, ''))
          .filter(Boolean)
      ));

  const examples = {
    product: "AI assistant for luxury car sales",
    audience: "dealership managers",
    budget: "$10,000",
    deadline: "2 weeks",
    segment: "premium market",
    metric: "test-drive bookings",
    horizon: "90 days",
    differentiator: "CRM-aware suggestions",
    channel: "LinkedIn + email",
    step_count: "5",
    brand: "Porsche Experience",
    tone: "executive",
    initiative: "AI follow-ups",
    cost: "$2k/month",
    time_saving: "10 hrs/week"
  };

  names.forEach(name => {
    const val = examples[name] || `{${name}}`;
    const pattern = new RegExp(`\\{\\s*${name}\\s*\\}`, 'g'); // {name} or { name }
    text = text.replace(pattern, val);
  });

  tplEl.value = text;

  if (names.length) {
    document.getElementById('variables').value = names.join(', ');
  }
}

async function runPrompt() {
  const output = document.getElementById('output');
  output.textContent = "Thinking...";
  try {
    const prompt = document.getElementById('template').value.trim();
    if (!prompt) {
      output.textContent = "Select a template first.";
      return;
    }
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt })
    });
    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();
    const brief = data.brief || {};
    const list = arr => (arr || []).map(x => `- ${x}`).join("\n");
    output.textContent = `
${data.prompt ? "Prompt: " + data.prompt + "\n\n" : ""}
Problem
${list(brief.problem)}

Users
${list(brief.users)}

Solution
${list(brief.solution)}

Value
${list(brief.value)}

Risks
${list(brief.risks)}

Next Actions
${list(brief.next_actions)}
`.trim();
  } catch (err) {
    output.textContent = "Error: " + err.message;
  }
}

function copyOutput() {
  const text = document.getElementById('output').textContent;
  navigator.clipboard.writeText(text);
}

// Load a default view on first open
loadCategory('strategy');
</script>
</body>
</html>
